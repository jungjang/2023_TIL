# 토큰을 어디에 저장할까

### 먼저 세션 
세션 vs 토큰( 토큰 저장을 로컬or쿠키 ) <br>
세션 - 서버 리소스 이용, 서버에서 관리,처리가능 <br>-> 많이 쓰면 서버에 부하(확장성문제)(+쿠키 사용해야함 (CSRF무서움))

## 토큰 저장 방식

- 토큰을 어디에 저장하는게 좋냐<br>
  로컬 vs 쿠키 

  로컬 - 보안에 취약 (영구저장이라 XSS에 취약)<br>
  쿠키 - CSRF 공격에 취약 <br>

이래서 AT와 RT라는 두 개의 토큰을 쓰기로 했다<br>
(AT는 접근권한용, RT는 재발급용으로 서버에서 관리)

둘다 쿠키에 담는다? CSRF공격 가능해짐 (AT, RT 다 상해서)<br>
둘다 로컬에 담는다? XSS공격 가능해짐

그리고 베스트는 AT는 JS지역변수에, RT는 쿠키에 담는거임<br>

이러면, <br>
AT는 CSRF공격으로부터 안전, XSS로부터 위험(그나마 로컬스토리지 저장에 비해 덜 위험)<br>
RT는 XSS로부터 안전(http only 덕분에 RT자체를 털 수 없음), CSRF로부터 위험<br>
-> 이 두개의 토큰이 서버에 들어가면 두 개를 비교해 교차검증을 하게 될 수 있는거임


만약 RT가 CSRF한테 털렸다? -> 어차피 AT(접근권한용) 없어서 접근권한 없음 (공격 차단 가능)<br>
-> 그리고 RT는 서버에서 관리해서 핸들링 가능<br>
RT 한 번만사용할 수 있게 만드는 방법도 있음 ( RT봤는데 이미사용한거면 차단 가능 )<br>
RT 가 털린다면 'AT발급이 진행된다면 이 과정에서 IP를 확인한다던가' 하는 방향으로<br> 검증작업을 서버에서 함

반대로<br>
AT가 XSS로 털렸다?<br>
-> 사용가능기한 짧아서 곧 다른 AT로 대체됨 ( 물론 그 시간 안에서는 활개칠 수 있긴 함(즉시차단X)<br>
둘 다 쿠키에 담으면 CSRF에 탈탈털림

# 결론
완벽히 막을 수 없다.<br>
이를 위해 라이브러리와 다양한 방법들을 써서 대응하는 것 뿐

ps.AT가 짧은 이유
- 지속적으로 네트워크 타며 노출될 가능성이 높기 
